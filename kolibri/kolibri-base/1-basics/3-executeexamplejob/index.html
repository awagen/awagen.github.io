<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.85.0"><meta name=description content><link rel="shortcut icon" href=/images/kolibri.svg type=image/x-icon><title>Executing examples :: Kolibri Documentation</title><link href=/css/nucleus.css?1638404501 rel=stylesheet><link href=/css/fontawesome-all.min.css?1638404501 rel=stylesheet><link href=/css/hybrid.css?1638404501 rel=stylesheet><link href=/css/featherlight.min.css?1638404501 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1638404501 rel=stylesheet><link href=/css/auto-complete.css?1638404501 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1638404501 rel=stylesheet><link href=/css/theme.css?1638404501 rel=stylesheet><link href=/css/tabs.css?1638404501 rel=stylesheet><link href=/css/hugo-theme.css?1638404501 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1638404501></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/kolibri/kolibri-base/1-basics/3-executeexamplejob/><nav id=sidebar><div id=header-wrapper><div id=header><img src=/images/kolibri.svg alt=Kolibri height=100><div>HOME OF KOLIBRI</div></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1638404501></script><script type=text/javascript src=/js/auto-complete.js?1638404501></script><script type=text/javascript>var baseurl="http://awagen.github.io/"</script><script type=text/javascript src=/js/search.js?1638404501></script></div><section id=homelinks><ul><li><a class=padding href=/><i class="fas fa-home"></i> Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/kolibri/ title="Kolibri Documentation" class="dd-item
parent"><a href=/kolibri/>Kolibri Documentation</a><ul><li data-nav-id=/kolibri/kolibri-datatypes/ title="Kolibri-DataTypes Documentation" class=dd-item><a href=/kolibri/kolibri-datatypes/>Kolibri-DataTypes Documentation</a><ul><li data-nav-id=/kolibri/kolibri-datatypes/1-types/ title=Types class=dd-item><a href=/kolibri/kolibri-datatypes/1-types/><b>1. </b>Types</a><ul><li data-nav-id=/kolibri/kolibri-datatypes/1-types/1-categories/ title="DataType Categories" class=dd-item><a href=/kolibri/kolibri-datatypes/1-types/1-categories/><b>1 - </b>DataType Categories</a></li></ul></li></ul></li><li data-nav-id=/kolibri/kolibri-base/ title="Kolibri-Base Documentation" class="dd-item
parent"><a href=/kolibri/kolibri-base/>Kolibri-Base Documentation</a><ul><li data-nav-id=/kolibri/kolibri-base/1-basics/ title=Basics class="dd-item
parent"><a href=/kolibri/kolibri-base/1-basics/><b>1. </b>Basics</a><ul><li data-nav-id=/kolibri/kolibri-base/1-basics/1-runningit/ title="Getting it started" class=dd-item><a href=/kolibri/kolibri-base/1-basics/1-runningit/><b>1 - </b>Getting it started</a></li><li data-nav-id=/kolibri/kolibri-base/1-basics/2-monitoring/ title=Monitoring class=dd-item><a href=/kolibri/kolibri-base/1-basics/2-monitoring/><b>2 - </b>Monitoring</a></li><li data-nav-id=/kolibri/kolibri-base/1-basics/3-executeexamplejob/ title="Executing examples" class="dd-item active"><a href=/kolibri/kolibri-base/1-basics/3-executeexamplejob/><b>3 - </b>Executing examples</a></li></ul></li><li data-nav-id=/kolibri/kolibri-base/2-mechanisms/ title=Mechanisms class=dd-item><a href=/kolibri/kolibri-base/2-mechanisms/><b>2. </b>Mechanisms</a><ul><li data-nav-id=/kolibri/kolibri-base/2-mechanisms/1-overview/ title=Basics class=dd-item><a href=/kolibri/kolibri-base/2-mechanisms/1-overview/><b>1 - </b>Basics</a></li></ul></li></ul></li><li data-nav-id=/kolibri/kolibri-watch/ title="Kolibri-Watch Documentation" class=dd-item><a href=/kolibri/kolibri-watch/>Kolibri-Watch Documentation</a><ul><li data-nav-id=/kolibri/kolibri-watch/1-ui/ title="UI - Kolibri Watch" class=dd-item><a href=/kolibri/kolibri-watch/1-ui/><b>3. </b>UI - Kolibri Watch</a><ul><li data-nav-id=/kolibri/kolibri-watch/1-ui/1-overview/ title=Overview class=dd-item><a href=/kolibri/kolibri-watch/1-ui/1-overview/><b>1 - </b>Overview</a></li></ul></li></ul></li></ul></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://github.com/awagen/kolibri/tree/main/kolibri-datatypes><i class="fab fa-github"></i> Github kolibri-datatypes repo</a></li><li><a class=padding href=https://github.com/awagen/kolibri/tree/main/kolibri-base><i class="fab fa-github"></i> Github kolibri-base repo</a></li><li><a class=padding href=https://github.com/awagen/kolibri/tree/main/kolibri-watch><i class="fab fa-github"></i> Github kolibri-watch repo</a></li><li><a class=padding href=https://github.com/awagen/response-juggler><i class="fab fa-github"></i> Github response-juggler repo</a></li><li><a class=padding href=https://www.linkedin.com/in/andreas-wagenmann/><i class="fab fa-linkedin"></i> LinkedIn</a></li><li><a class=padding href=https://twitter.com/andiwagen><i class="fab fa-twitter"></i> Twitter</a></li></ul></section><section id=footer></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=/>Home</a> > <a href=/kolibri/>Kolibri Documentation</a> > <a href=/kolibri/kolibri-base/>Kolibri-Base Documentation</a> > <a href=/kolibri/kolibri-base/1-basics/>Basics</a> > Executing examples</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#example-job-definition-explained>Example Job Definition Explained</a></li><li><a href=#example-aggregation--analyze-executions>Example Aggregation / Analyze Executions</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Executing examples</h1><p>An example job definition for a parameter grid search evaluating search metrics against a given endpoint
is provided within the scripts-folder.
The definition is contained in the file <code>testSearchEval.json</code>, that can be send to the respective Kolibri endpoints
(see <code>start_searcheval.sh</code>). Where the response is written is configured via properties/env variables
(see respective part of the documentation).
A simpler way is to start up the app along with the UI (Kolibri Watch, see respective section of this doc),
and navigate to the CREATE menu, select the search evaluation type and choose a job execution definition template.
From this UI you can directly edit an existing template, save it and start the execution.
Note that the execution below makes a few assumptions for the processing to work.</p><p>Lets have a look at the definition and then define the meaning of the distinct sections of the used json.
You&rsquo;ll see something like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;jobName&#34;</span>: <span style=color:#e6db74>&#34;testJob&#34;</span>,
  <span style=color:#f92672>&#34;fixedParams&#34;</span>: {
    <span style=color:#f92672>&#34;k1&#34;</span>: [
      <span style=color:#e6db74>&#34;v1&#34;</span>,
      <span style=color:#e6db74>&#34;v2&#34;</span>
    ],
    <span style=color:#f92672>&#34;k2&#34;</span>: [
      <span style=color:#e6db74>&#34;v3&#34;</span>
    ]
  },
  <span style=color:#f92672>&#34;contextPath&#34;</span>: <span style=color:#e6db74>&#34;search&#34;</span>,
  <span style=color:#f92672>&#34;connections&#34;</span>: [
    {
      <span style=color:#f92672>&#34;host&#34;</span>: <span style=color:#e6db74>&#34;search-service&#34;</span>,
      <span style=color:#f92672>&#34;port&#34;</span>: <span style=color:#ae81ff>80</span>,
      <span style=color:#f92672>&#34;useHttps&#34;</span>: <span style=color:#66d9ef>false</span>
    },
    {
      <span style=color:#f92672>&#34;host&#34;</span>: <span style=color:#e6db74>&#34;search-service1&#34;</span>,
      <span style=color:#f92672>&#34;port&#34;</span>: <span style=color:#ae81ff>81</span>,
      <span style=color:#f92672>&#34;useHttps&#34;</span>: <span style=color:#66d9ef>false</span>
    }
  ],
  <span style=color:#f92672>&#34;requestPermutation&#34;</span>: [
    {
      <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;ALL&#34;</span>,
      <span style=color:#f92672>&#34;value&#34;</span>: {
        <span style=color:#f92672>&#34;params&#34;</span>: {
          <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;FROM_FILES_LINES&#34;</span>,
          <span style=color:#f92672>&#34;values&#34;</span>: {
            <span style=color:#f92672>&#34;q&#34;</span>: <span style=color:#e6db74>&#34;/app/test-files/test-paramfiles/test_queries.txt&#34;</span>
          }
        }
      }
    },
    {
      <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;ALL&#34;</span>,
      <span style=color:#f92672>&#34;value&#34;</span>: {
        <span style=color:#f92672>&#34;params&#34;</span>: {
          <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;GRID_FROM_VALUES_SEQ&#34;</span>,
          <span style=color:#f92672>&#34;values&#34;</span>: [
            {
              <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;a1&#34;</span>,
              <span style=color:#f92672>&#34;values&#34;</span>: [
                <span style=color:#ae81ff>0.45</span>,
                <span style=color:#ae81ff>0.32</span>
              ]
            },
            {
              <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;o&#34;</span>,
              <span style=color:#f92672>&#34;start&#34;</span>: <span style=color:#ae81ff>0.0</span>,
              <span style=color:#f92672>&#34;end&#34;</span>: <span style=color:#ae81ff>2000.0</span>,
              <span style=color:#f92672>&#34;stepSize&#34;</span>: <span style=color:#ae81ff>1.0</span>
            }
          ]
        }
      }
    }
  ],
  <span style=color:#f92672>&#34;batchByIndex&#34;</span>: <span style=color:#ae81ff>0</span>,
  <span style=color:#f92672>&#34;parsingConfig&#34;</span>: {
    <span style=color:#f92672>&#34;singleSelectors&#34;</span>: [],
    <span style=color:#f92672>&#34;seqSelectors&#34;</span>: [
      {
        <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;productIds&#34;</span>,
        <span style=color:#f92672>&#34;castType&#34;</span>: <span style=color:#e6db74>&#34;STRING&#34;</span>,
        <span style=color:#f92672>&#34;selector&#34;</span>: {
          <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;PLAINREC&#34;</span>,
          <span style=color:#f92672>&#34;path&#34;</span>: <span style=color:#e6db74>&#34;\\ response \\ docs \\\\ product_id&#34;</span>
        }
      }
    ]
  },
  <span style=color:#f92672>&#34;excludeParamsFromMetricRow&#34;</span>: [
    <span style=color:#e6db74>&#34;q&#34;</span>
  ],
  <span style=color:#f92672>&#34;taggingConfiguration&#34;</span>: {
    <span style=color:#f92672>&#34;initTagger&#34;</span>: {
      <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;REQUEST_PARAMETER&#34;</span>,
      <span style=color:#f92672>&#34;parameter&#34;</span>: <span style=color:#e6db74>&#34;q&#34;</span>,
      <span style=color:#f92672>&#34;extend&#34;</span>: <span style=color:#66d9ef>false</span>
    },
    <span style=color:#f92672>&#34;processedTagger&#34;</span>: {
      <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;NOTHING&#34;</span>
    },
    <span style=color:#f92672>&#34;resultTagger&#34;</span>: {
      <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;NOTHING&#34;</span>
    }
  },
  <span style=color:#f92672>&#34;requestTemplateStorageKey&#34;</span>: <span style=color:#e6db74>&#34;requestTemplate&#34;</span>,
  <span style=color:#f92672>&#34;mapFutureMetricRowCalculation&#34;</span>: {
    <span style=color:#f92672>&#34;functionType&#34;</span>: <span style=color:#e6db74>&#34;IR_METRICS&#34;</span>,
    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;irMetrics&#34;</span>,
    <span style=color:#f92672>&#34;queryParamName&#34;</span>: <span style=color:#e6db74>&#34;q&#34;</span>,
    <span style=color:#f92672>&#34;requestTemplateKey&#34;</span>: <span style=color:#e6db74>&#34;requestTemplate&#34;</span>,
    <span style=color:#f92672>&#34;productIdsKey&#34;</span>: <span style=color:#e6db74>&#34;productIds&#34;</span>,
    <span style=color:#f92672>&#34;judgementProvider&#34;</span>: {
      <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;FILE_BASED&#34;</span>,
      <span style=color:#f92672>&#34;filename&#34;</span>: <span style=color:#e6db74>&#34;/app/test-files/test-judgements/test_judgements.txt&#34;</span>
    },
    <span style=color:#f92672>&#34;metricsCalculation&#34;</span>: {
      <span style=color:#f92672>&#34;metrics&#34;</span>: [
        {<span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;DCG_10&#34;</span>, <span style=color:#f92672>&#34;function&#34;</span>: {<span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;DCG&#34;</span>, <span style=color:#f92672>&#34;k&#34;</span>: <span style=color:#ae81ff>10</span>}},
        {<span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;NDCG_10&#34;</span>, <span style=color:#f92672>&#34;function&#34;</span>: {<span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;NDCG&#34;</span>, <span style=color:#f92672>&#34;k&#34;</span>: <span style=color:#ae81ff>10</span>}},
        {<span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;PRECISION_4&#34;</span>, <span style=color:#f92672>&#34;function&#34;</span>: {<span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;PRECISION&#34;</span>, <span style=color:#f92672>&#34;k&#34;</span>: <span style=color:#ae81ff>4</span>, <span style=color:#f92672>&#34;threshold&#34;</span>:  <span style=color:#ae81ff>0.1</span>}},
        {<span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;ERR_10&#34;</span>, <span style=color:#f92672>&#34;function&#34;</span>: {<span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;ERR&#34;</span>, <span style=color:#f92672>&#34;k&#34;</span>: <span style=color:#ae81ff>10</span>}}
      ],
      <span style=color:#f92672>&#34;judgementHandling&#34;</span>: {
        <span style=color:#f92672>&#34;validations&#34;</span>: [
          <span style=color:#e6db74>&#34;EXIST_RESULTS&#34;</span>,
          <span style=color:#e6db74>&#34;EXIST_JUDGEMENTS&#34;</span>
        ],
        <span style=color:#f92672>&#34;handling&#34;</span>: <span style=color:#e6db74>&#34;AS_ZEROS&#34;</span>
      }
    },
    <span style=color:#f92672>&#34;excludeParams&#34;</span>: [
      <span style=color:#e6db74>&#34;q&#34;</span>
    ]
  },
  <span style=color:#f92672>&#34;singleMapCalculations&#34;</span>: [],
  <span style=color:#f92672>&#34;allowedTimePerElementInMillis&#34;</span>: <span style=color:#ae81ff>1000</span>,
  <span style=color:#f92672>&#34;allowedTimePerBatchInSeconds&#34;</span>: <span style=color:#ae81ff>6000</span>,
  <span style=color:#f92672>&#34;allowedTimeForJobInSeconds&#34;</span>: <span style=color:#ae81ff>720000</span>,
  <span style=color:#f92672>&#34;expectResultsFromBatchCalculations&#34;</span>: <span style=color:#66d9ef>false</span>,
  <span style=color:#f92672>&#34;wrapUpFunction&#34;</span>: {
    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;AGGREGATE_FROM_DIR_BY_REGEX&#34;</span>,
    <span style=color:#f92672>&#34;weightProvider&#34;</span>: {
      <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;CONSTANT&#34;</span>,
      <span style=color:#f92672>&#34;weight&#34;</span>: <span style=color:#ae81ff>1.0</span>
    },
    <span style=color:#f92672>&#34;regex&#34;</span>: <span style=color:#e6db74>&#34;[(]q=.+[)]&#34;</span>,
    <span style=color:#f92672>&#34;outputFilename&#34;</span>: <span style=color:#e6db74>&#34;(ALL1)&#34;</span>,
    <span style=color:#f92672>&#34;readSubDir&#34;</span>: <span style=color:#e6db74>&#34;testJob&#34;</span>,
    <span style=color:#f92672>&#34;writeSubDir&#34;</span>: <span style=color:#e6db74>&#34;testJob&#34;</span>
  }
}
</code></pre></div><h3 id=example-job-definition-explained>Example Job Definition Explained</h3><h4 id=parameter-meaning>Parameter meaning</h4><p>The above on posting to the <code>search_eval_no_ser</code> endpoint is parsed into an JobMessages.SearchEvaluation instance.
Within Kolibri, the parsing of sent data utilizes the <em><strong>spray</strong></em> lib, and all types except base types need
a JsonFormat definition that specifies how a passed json is transformed into the specific object and how an object
is transformed back to its string representation. Those definitions are always found within the &lsquo;de.awagen.kolibri-[datatypes/base].io.json&rsquo; package
and carry the suffix JsonProtocol. More details on this in the follow up sections.</p><p>The actual SearchEvaluation message case class looks like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SearchEvaluation</span><span style=color:#f92672>(</span>jobName<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>,</span>
                            fixedParams<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Map</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span>, <span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span><span style=color:#f92672>]],</span>
                            contextPath<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>,</span>
                            connections<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Connection</span><span style=color:#f92672>],</span>
                            requestPermutation<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>ModifierGeneratorProvider</span><span style=color:#f92672>],</span>
                            batchByIndex<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>,</span>
                            parsingConfig<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ParsingConfig</span><span style=color:#f92672>,</span>
                            excludeParamsFromMetricRow<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span><span style=color:#f92672>],</span>
                            requestTemplateStorageKey<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>,</span>
                            mapFutureMetricRowCalculation<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>FutureCalculation</span><span style=color:#f92672>[</span><span style=color:#66d9ef>WeaklyTypedMap</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>MetricRow</span><span style=color:#f92672>],</span>
                            singleMapCalculations<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Calculation</span><span style=color:#f92672>[</span><span style=color:#66d9ef>WeaklyTypedMap</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>CalculationResult</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Double</span><span style=color:#f92672>]]],</span>
                            taggingConfiguration<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Option</span><span style=color:#f92672>[</span><span style=color:#66d9ef>BaseTaggingConfiguration</span><span style=color:#f92672>[</span><span style=color:#66d9ef>RequestTemplate</span>, 
                            <span style=color:#f92672>(</span><span style=color:#66d9ef>Either</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Throwable</span>, <span style=color:#66d9ef>WeaklyTypedMap</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span><span style=color:#f92672>]]</span>, <span style=color:#66d9ef>RequestTemplate</span><span style=color:#f92672>)</span>, <span style=color:#66d9ef>MetricRow</span><span style=color:#f92672>]],</span>
                            wrapUpFunction<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Option</span><span style=color:#f92672>[</span><span style=color:#66d9ef>JobWrapUpFunction</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Unit</span><span style=color:#f92672>]],</span>
                            allowedTimePerElementInMillis<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1000</span><span style=color:#f92672>,</span>
                            allowedTimePerBatchInSeconds<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>600</span><span style=color:#f92672>,</span>
                            allowedTimeForJobInSeconds<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>7200</span><span style=color:#f92672>,</span>
                            expectResultsFromBatchCalculations<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Boolean</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>JobMessage</span>
</code></pre></div><p>Lets summarize what the distinct attribute are used for:</p><table><thead><tr><th>Name:Type</th><th>What for?</th></tr></thead><tbody><tr><td><em>jobName: String</em></td><td>job name for the execution. If execution with same jobName is running, the request to start another one with the same name will be denied.</td></tr><tr><td><em>fixedParams: Map[String, Seq[String]]</em></td><td>Parameter name/values mapping for parameters that wont change between requests.</td></tr><tr><td><em>contextPath: String</em></td><td>Context path for the requests. The host settings where to send those requests to is defined within connections.</td></tr><tr><td><em>connections: Seq[Connection]</em></td><td>Single or multiple connections against which the requests shall be sent. A connection holds host, port, flag whether to use https or http and optional credentials.</td></tr><tr><td><em>requestPermutation: : Seq[ModifierGeneratorProvider]</em></td><td>Single or multiple ModifierGeneratorProvider. Each of those providers provides methods to retrieve the Seq of generators of modifiers of RequestTemplateBuilders or a partitioning, which is a generator of generators of mentioned modifiers. For more detail see later sections.</td></tr><tr><td><em>batchByIndex: Int</em></td><td>index (0-based) to define which generator of modifiers to batch by. E.g in the above example specification setting this value to 0 batches by the generator what generates the modifiers corresponding to the single query-parameter values, e.g its the first one in the definition, thus index 0.</td></tr><tr><td><em>parsingConfig: ParsingConfig</em></td><td>The parsing configuration defining which values to extract as what data type and under which key to place into the result map. The result map can then be utilized to derive metrics / tags or similar.</td></tr><tr><td><em>excludeParamsFromMetricRow: Seq[String]</em></td><td>Gives the parameter names that shall not be part of the parameter set in the aggregation result (MetricRow[Double]). For same given tags results would be aggregated per set of parameters, thus if this shall not happen on the per-query level, or if overall aggregation shall aggregate values over multiple queries, query parameter should be added here. If granularity on per-query level is needed, this should be reflected in the tag sticked to the result instead (for more details on tagging see later sections of the doc).</td></tr><tr><td><em>requestTemplateStorageKey: String</em></td><td>This simply defines an arbitrary storage key used to put the request template in the result map for further reference down the processing chain.</td></tr><tr><td><em>mapFutureMetricRowCalculation: FutureCalculation[WeaklyTypedMap[String], MetricRow]</em></td><td>Definition of the MetricRow calculation based on WeaklyTypedMap[String], yielding a Future result due to additional steps involved such as loading the judgements.</td></tr><tr><td><em>singleMapCalculations: Seq[Calculation[WeaklyTypedMap[String], CalculationResult[Double]]]</em></td><td>Additional calculations based on WeaklyTypedMap[String] parsed response, leading to CalculationResult[Double]</td></tr><tr><td><em>taggingConfiguration: Option[BaseTaggingConfiguration[RequestTemplate, (Either[Throwable, WeaklyTypedMap[String]], RequestTemplate), MetricRow]]</em></td><td>This specifies a tagging configuration, allowing tagging on the request level (using RequestTemplate), on the response level (using (Either[Throwable, WeaklyTypedMap[String]], RequestTemplate)) and on the final outcome level (using the result MetricRow[Double] object)</td></tr><tr><td><em>wrapUpFunction: Option[JobWrapUpFunction[Unit]]</em></td><td>Wrap-up function to execute after the execution has finished. This could be the aggregation of all single results to an overall result or similar. This is executed on the node of the Job Manager Actor. In case of many single results, its beneficial to write results directly from the nodes generating the results and aggregating all to an overall result later instead of sending all partial results as serialized messages across the cluster.</td></tr><tr><td><em>allowedTimePerElementInMillis: Int</em></td><td>Specifies the time in milliseconds a single processing element in batch can take till finishing.</td></tr><tr><td><em>allowedTimePerBatchInSeconds: Int</em></td><td>Specifies the time a single batch is allowed to take till finishing execution (in seconds).</td></tr><tr><td><em>allowedTimeForJobInSeconds: Int</em></td><td>Specifies the time a full job is allowed to execute. If exceeding the time, the job is aborted (time given in seconds)</td></tr><tr><td><em>expectResultsFromBatchCalculations: Boolean</em></td><td>Specifies whether the job manager actor expects results for single batches back from the single executing nodes.</td></tr></tbody></table><h4 id=example-definition-explained>Example definition explained</h4><p>In the above example job definitions you can observe the following:</p><ul><li>jobName is &ldquo;testJob&rdquo;</li><li>fixed parameters are set and will be used for each request: <code>k1=v1&k1=v2&k2=v3</code></li><li>contextPath is &ldquo;search&rdquo;</li><li>connections specifies to distinct connections, one going to host &ldquo;search-service:80&rdquo;, the other to &ldquo;search-service1:81&rdquo;, both using normal http:// requests without credentials set.
This makes the assumptions that the corresponding services are running and indeed exposing a &ldquo;search&rdquo;-endpoint.
The execution flow utilizes a balanced execution across connections, thus about
equal load can be expected on both if both have similar latencies.</li><li>the request permutation permutates only different url parameters, but does not vary
headers or bodies. The permutated parameter values include q1-q10 for parameter &ldquo;q&rdquo;, values 0.45 and 0.32 for parameter &ldquo;a1&rdquo; and 2001 parameter values in the range [0.0, 2000.0] in step sizes of 1 for parameter &ldquo;o&rdquo;.
Note that the order of parameters plays a role here, since the parameter &ldquo;batchByIndex&rdquo; refers to exactly this ordering, e.g if set to 0 using parameter &ldquo;q&rdquo;. Index 1 would refer to parameter &ldquo;a1&rdquo;, index 2 to parameter &ldquo;o&rdquo;.</li><li>batchByIndex = 0, thus each batch only handles a single setting for parameter &ldquo;q&rdquo;.
We want to have per-query granularity here, thus each batch result corresponds to a valid aggregation by itself. These concerns about the smallest granularity needed should go into decision which modifiers to batch by.</li><li>parsing config only specifies the parsing of values with key &ldquo;productIds&rdquo;, assuming
each element to be of type String. That we are expecting a Seq and not a single value
is given by the fact that the selector is defined within &ldquo;seqSelectors&rdquo; and within the &ldquo;selector&rdquo; the type is <code>PLAINREC</code>, meaning plain recursive. The path is set to
<code>\\ response \\ docs \\\\ product_id</code>, which describes a json path like this:</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;response&#34;</span>: {
    <span style=color:#f92672>&#34;docs&#34;</span>: [
      {<span style=color:#f92672>&#34;product_id&#34;</span>:  <span style=color:#e6db74>&#34;value1&#34;</span>},
      {<span style=color:#f92672>&#34;product_id&#34;</span>:  <span style=color:#e6db74>&#34;value2&#34;</span>}
    ]
  }
}
</code></pre></div><p>In the result product ids can be retrieved of the result map via key &ldquo;productIds&rdquo;.
There are multiple variants to parse data out of a json, such as (see <code>JsonSelectorJsonProtocol</code> and <code>TypedJsonSelectorJsonProtocol</code>)</p><ol><li><code>SINGLEREC</code>: single recursive selector, e.g recursively on json root without any selectors before</li><li><code>PLAINREC</code>: some plain path selectors followed by recursive selector at the end</li><li><code>RECPLAIN</code>: recursive selector (may contain plain path) then mapped to some plain selection (each element from recursive selection)</li><li><code>RECREC</code>: recursive selector (may contain plain path) then flatMapped to another recursive selector (each element from the first recursive selection,
<code>//</code> e.g mapping the Seq[JsValue] elements)</li></ol><ul><li>parameter &ldquo;q&rdquo; is the only parameter given in &ldquo;excludeParamsFromMetricRow&rdquo; setting, since we dont want the parameter &ldquo;q&rdquo; to occur as parameter in our aggregated MetricRow[Double] result, since aggregations are done per parameter setting lateron, and we couldnt do this before we removed the parameter &ldquo;q&rdquo; from the single results. As youll see below, we rather include parameter q in the tagging of the single results.</li><li>&ldquo;taggingConfiguration&rdquo; specifies that we won&rsquo;t add a tag for the parsed result or the final MetricRow[Double] result, but we will tag based on the RequestTemplate&rsquo;s request parameter &ldquo;q&rdquo; for each request to the external endpoint.
This will effectively result in one partial result per query, with filename given by the Tag toString method, in this case
resulting in names <code>(q=[paramValue])</code>, e.g (q=q1), (q=q2), and so on.</li><li>&ldquo;requestTemplateStorageKey&rdquo;: simply defines under which value the RequestTemplate value is stored in the result map. As you saw above, we already stored the parsed product IDs with key &ldquo;productIds&rdquo;, and RequestTemplate used for the request will be stored under &ldquo;requestTemplate&rdquo;.</li><li>&ldquo;mapFutureMetricRowCalculation&rdquo; specifies which metrics are calculated based on which
judgement file, which metrics are calculated (in the example DCG@10, NDCG@10, PRECISION@4, ERR).
It also specifies validations on judgements and handling of missing judgements.
In the given example validations include validation that there are productId results, that some judgements exist for the results,
and if those validations are passed missing judgements are handled as by replacement with value 0.0.</li><li>&ldquo;singleMapCalculations&rdquo; is empty, thus no additional calculations are executed apart from above defined metrics.</li><li>&ldquo;allowedTimePerElementInMillis&rdquo; is set to 1000, thus we allow up to 1s for each element to finish processing</li><li>&ldquo;allowedTimePerBatchInSeconds&rdquo;: here we allow 6000 seconds, thus 100 minutes for a single batch to execute</li><li>&ldquo;allowedTimeForJobInSeconds&rdquo;: is set to 720000 seconds, meaning 120 * 100 minutes</li><li>&ldquo;expectResultsFromBatchCalculations&rdquo; is set to &ldquo;false&rdquo;, thus no results are serialized and sent across the cluster back to the Job Manager.</li><li>&ldquo;wrapUpFunction&rdquo; is defined such that all results matching the given regex are aggregated to an overall result
and written to file with name &ldquo;(ALL1)&rdquo; into the same folder the single results were
picked from (e.g for this subDir must be same as jobName). Also, a weightProvider can be defined to provide distinct weights per query,
or just one of type &ldquo;CONSTANT&rdquo; with the weight to apply for all samples:</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;AGGREGATE_FROM_DIR_BY_REGEX&#34;</span>,
  <span style=color:#f92672>&#34;weightProvider&#34;</span>: {
    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;CONSTANT&#34;</span>,
    <span style=color:#f92672>&#34;weight&#34;</span>: <span style=color:#ae81ff>1.0</span>
  },
  <span style=color:#f92672>&#34;regex&#34;</span>: <span style=color:#e6db74>&#34;[(]q=.+[)]&#34;</span>,
  <span style=color:#f92672>&#34;outputFilename&#34;</span>: <span style=color:#e6db74>&#34;(ALL1)&#34;</span>,
  <span style=color:#f92672>&#34;readSubDir&#34;</span>: <span style=color:#e6db74>&#34;testJob&#34;</span>,
  <span style=color:#f92672>&#34;writeSubDir&#34;</span>: <span style=color:#e6db74>&#34;testJob&#34;</span>
}
</code></pre></div><h3 id=example-aggregation--analyze-executions>Example Aggregation / Analyze Executions</h3><p>Kolibri provides an execution-endpoint, for which examples can be found in the
&lsquo;testAggregation.json&rsquo; (aggregation example, same as used for the wrapup function above)
and &lsquo;testAnalyze.json&rsquo;</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;ANALYZE_BEST_WORST_REGEX&#34;</span>,
  <span style=color:#f92672>&#34;directory&#34;</span>: <span style=color:#e6db74>&#34;testJob&#34;</span>,
  <span style=color:#f92672>&#34;regex&#34;</span>: <span style=color:#e6db74>&#34;[(]q=.+[)]&#34;</span>,
  <span style=color:#f92672>&#34;currentParams&#34;</span>: {
    <span style=color:#f92672>&#34;a1&#34;</span>: [<span style=color:#e6db74>&#34;0.45&#34;</span>],
    <span style=color:#f92672>&#34;k1&#34;</span>: [<span style=color:#e6db74>&#34;v1&#34;</span>, <span style=color:#e6db74>&#34;v2&#34;</span>],
    <span style=color:#f92672>&#34;k2&#34;</span>: [<span style=color:#e6db74>&#34;v3&#34;</span>],
    <span style=color:#f92672>&#34;o&#34;</span>: [<span style=color:#e6db74>&#34;479.0&#34;</span>]
  },
  <span style=color:#f92672>&#34;compareParams&#34;</span>: [
    {
      <span style=color:#f92672>&#34;a1&#34;</span>: [<span style=color:#e6db74>&#34;0.32&#34;</span>],
      <span style=color:#f92672>&#34;k1&#34;</span>: [<span style=color:#e6db74>&#34;v1&#34;</span>, <span style=color:#e6db74>&#34;v2&#34;</span>],
      <span style=color:#f92672>&#34;k2&#34;</span>: [<span style=color:#e6db74>&#34;v3&#34;</span>],
      <span style=color:#f92672>&#34;o&#34;</span>: [<span style=color:#e6db74>&#34;1760.0&#34;</span>]
    },
    {
      <span style=color:#f92672>&#34;a1&#34;</span>: [<span style=color:#e6db74>&#34;0.45&#34;</span>],
      <span style=color:#f92672>&#34;k1&#34;</span>: [<span style=color:#e6db74>&#34;v1&#34;</span>, <span style=color:#e6db74>&#34;v2&#34;</span>],
      <span style=color:#f92672>&#34;k2&#34;</span>: [<span style=color:#e6db74>&#34;v3&#34;</span>],
      <span style=color:#f92672>&#34;o&#34;</span>: [<span style=color:#e6db74>&#34;384.0&#34;</span>]
    },
    {
      <span style=color:#f92672>&#34;a1&#34;</span>: [<span style=color:#e6db74>&#34;0.45&#34;</span>],
      <span style=color:#f92672>&#34;k1&#34;</span>: [<span style=color:#e6db74>&#34;v1&#34;</span>, <span style=color:#e6db74>&#34;v2&#34;</span>],
      <span style=color:#f92672>&#34;k2&#34;</span>: [<span style=color:#e6db74>&#34;v3&#34;</span>],
      <span style=color:#f92672>&#34;o&#34;</span>: [<span style=color:#e6db74>&#34;1325.0&#34;</span>]
    }
  ],
  <span style=color:#f92672>&#34;metricName&#34;</span>: <span style=color:#e6db74>&#34;NDCG_10&#34;</span>,
  <span style=color:#f92672>&#34;queryParamName&#34;</span>: <span style=color:#e6db74>&#34;q&#34;</span>,
  <span style=color:#f92672>&#34;n_best&#34;</span>: <span style=color:#ae81ff>5</span>,
  <span style=color:#f92672>&#34;n_worst&#34;</span>: <span style=color:#ae81ff>4</span>
}
</code></pre></div><p>The latter picks the single result files according to the provided regex, defines the parameters
to compare against (&lsquo;currentParams&rsquo;) and the variants to compare against (&lsquo;compareParams&rsquo;).
Futher, &lsquo;metricName&rsquo; defines the name of the metric to use for comparison, and
&lsquo;n_best&rsquo; and &lsquo;n_worst&rsquo; defines the n most increasing values / most decreasing values to be kept.
&lsquo;queryParamName&rsquo; specifies the parameter name that in this example is extracted by regex from the file name
of the partial result.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/kolibri/kolibri-base/1-basics/2-monitoring/ title=Monitoring><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/kolibri/kolibri-base/2-mechanisms/ title=Mechanisms style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1638404501></script><script src=/js/perfect-scrollbar.min.js?1638404501></script><script src=/js/perfect-scrollbar.jquery.min.js?1638404501></script><script src=/js/jquery.sticky.js?1638404501></script><script src=/js/featherlight.min.js?1638404501></script><script src=/js/highlight.pack.js?1638404501></script><script>hljs.initHighlightingOnLoad()</script><script src=/js/modernizr.custom-3.6.0.js?1638404501></script><script src=/js/learn.js?1638404501></script><script src=/js/hugo-learn.js?1638404501></script><script src=/mermaid/mermaid.js?1638404501></script><script>mermaid.initialize({startOnLoad:!0})</script></body></html>