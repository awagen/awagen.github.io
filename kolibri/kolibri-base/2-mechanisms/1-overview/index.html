<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.85.0"><meta name=description content><link rel="shortcut icon" href=/images/kolibri.svg type=image/x-icon><title>Basics :: Kolibri Documentation</title><link href=/css/nucleus.css?1638401161 rel=stylesheet><link href=/css/fontawesome-all.min.css?1638401161 rel=stylesheet><link href=/css/hybrid.css?1638401161 rel=stylesheet><link href=/css/featherlight.min.css?1638401161 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1638401161 rel=stylesheet><link href=/css/auto-complete.css?1638401161 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1638401161 rel=stylesheet><link href=/css/theme.css?1638401161 rel=stylesheet><link href=/css/tabs.css?1638401161 rel=stylesheet><link href=/css/hugo-theme.css?1638401161 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1638401161></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/kolibri/kolibri-base/2-mechanisms/1-overview/><nav id=sidebar><div id=header-wrapper><div id=header><img src=/images/kolibri.svg alt=Kolibri height=100><div>HOME OF KOLIBRI</div></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1638401161></script><script type=text/javascript src=/js/auto-complete.js?1638401161></script><script type=text/javascript>var baseurl="http://awagen.github.io/"</script><script type=text/javascript src=/js/search.js?1638401161></script></div><section id=homelinks><ul><li><a class=padding href=/><i class="fas fa-home"></i> Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/kolibri/ title="Kolibri Documentation" class="dd-item
parent"><a href=/kolibri/>Kolibri Documentation</a><ul><li data-nav-id=/kolibri/kolibri-datatypes/ title="Kolibri-DataTypes Documentation" class=dd-item><a href=/kolibri/kolibri-datatypes/>Kolibri-DataTypes Documentation</a><ul><li data-nav-id=/kolibri/kolibri-datatypes/1-types/ title=Types class=dd-item><a href=/kolibri/kolibri-datatypes/1-types/><b>1. </b>Types</a><ul><li data-nav-id=/kolibri/kolibri-datatypes/1-types/1-categories/ title="DataType Categories" class=dd-item><a href=/kolibri/kolibri-datatypes/1-types/1-categories/><b>1 - </b>DataType Categories</a></li></ul></li></ul></li><li data-nav-id=/kolibri/kolibri-base/ title="Kolibri-Base Documentation" class="dd-item
parent"><a href=/kolibri/kolibri-base/>Kolibri-Base Documentation</a><ul><li data-nav-id=/kolibri/kolibri-base/1-basics/ title=Basics class=dd-item><a href=/kolibri/kolibri-base/1-basics/><b>1. </b>Basics</a><ul><li data-nav-id=/kolibri/kolibri-base/1-basics/1-runningit/ title="Getting it started" class=dd-item><a href=/kolibri/kolibri-base/1-basics/1-runningit/><b>1 - </b>Getting it started</a></li><li data-nav-id=/kolibri/kolibri-base/1-basics/2-monitoring/ title=Monitoring class=dd-item><a href=/kolibri/kolibri-base/1-basics/2-monitoring/><b>2 - </b>Monitoring</a></li><li data-nav-id=/kolibri/kolibri-base/1-basics/3-executeexamplejob/ title="Executing examples" class=dd-item><a href=/kolibri/kolibri-base/1-basics/3-executeexamplejob/><b>3 - </b>Executing examples</a></li></ul></li><li data-nav-id=/kolibri/kolibri-base/2-mechanisms/ title=Mechanisms class="dd-item
parent"><a href=/kolibri/kolibri-base/2-mechanisms/><b>2. </b>Mechanisms</a><ul><li data-nav-id=/kolibri/kolibri-base/2-mechanisms/1-overview/ title=Basics class="dd-item active"><a href=/kolibri/kolibri-base/2-mechanisms/1-overview/><b>1 - </b>Basics</a></li></ul></li><li data-nav-id=/kolibri/kolibri-base/3-ui/ title="UI - Kolibri Watch" class=dd-item><a href=/kolibri/kolibri-base/3-ui/><b>3. </b>UI - Kolibri Watch</a><ul><li data-nav-id=/kolibri/kolibri-base/3-ui/1-overview/ title=Overview class=dd-item><a href=/kolibri/kolibri-base/3-ui/1-overview/><b>1 - </b>Overview</a></li></ul></li></ul></li></ul></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://github.com/awagen/kolibri-datatypes><i class="fab fa-github"></i> Github kolibri-datatypes repo</a></li><li><a class=padding href=https://github.com/awagen/kolibri-base><i class="fab fa-github"></i> Github kolibri-base repo</a></li><li><a class=padding href=https://www.linkedin.com/in/andreas-wagenmann/><i class="fab fa-linkedin"></i> LinkedIn</a></li><li><a class=padding href=https://twitter.com/andiwagen><i class="fab fa-twitter"></i> Twitter</a></li></ul></section><section id=footer></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=/>Home</a> > <a href=/kolibri/>Kolibri Documentation</a> > <a href=/kolibri/kolibri-base/>Kolibri-Base Documentation</a> > <a href=/kolibri/kolibri-base/2-mechanisms/>Mechanisms</a> > Basics</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#basics>Basics</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Basics</h1><h2 id=basics>Basics</h2><p>First, all batches are represented by an ActorRunnable object, that on execution provides a tuple of a <code>KillSwitch</code> and
Future[Done] which completes when the execution completes. The KillSwitch allows killing the execution if indicated. The
criteria whether an execution is to be stopped is represented by an <code>ExecutionExpectation</code> instance, which can contain
multiple
<code>failedWhenMetExpectations</code>, that is e.g if a certain rate or number of failed data sample processings or a timeout
is exceeded.</p><p><img src="/images/graph_creation_1.png?raw=true" alt="Alt text" title="Kolibri RunnableGraph"></p><p>The <code>RunnableGraph</code> is provided by an <code>ActorRunnable</code> instance, which is the representation of each batch execution.
An ActorRunnable has the following signature:</p><pre><code>case class ActorRunnable[U, V, V1, Y &lt;: WithCount](jobId: String,
                                                   batchNr: Int,
                                                   supplier: IndexedGenerator[U],
                                                   transformer: Flow[U, ProcessingMessage[V], NotUsed],
                                                   processingActorProps: Option[Props],
                                                   aggregatorConfig: AggregatorConfig[V1, Y],
                                                   expectationGenerator: Int =&gt; ExecutionExpectation,
                                                   sinkType: job.ActorRunnableSinkType.Value,
                                                   waitTimePerElement: FiniteDuration,
                                                   maxExecutionDuration: FiniteDuration,
                                                   sendResultsBack: Boolean) extends KolibriSerializable with WithBatchNr 
</code></pre><p>The arguments are as follows:</p><table><thead><tr><th>Name:Type</th><th>What for?</th></tr></thead><tbody><tr><td><em>jobId: String</em></td><td>job identifier of which the ActorRunnable presents a batch</td></tr><tr><td><em>batchNr: Int</em></td><td>number of the batch of the job identified by jobId</td></tr><tr><td><em>supplier: IndexedGenerator[U]</em></td><td>generator providing the single elements to process, each of which is of type U (covariant)</td></tr><tr><td><em>transformer: Flow[U, ProcessingMessage[V], NotUsed]</em></td><td>a processing flow of initial element of type U (covariant) to ProcessingMessage[V] holding the data of type V (covariant). ProcessingMessage is essentially a data container allowing specifying a weight for the data sample and typed application of tags (e.g for grouping and group-wise aggregations)</td></tr><tr><td><em>processingActorProps: Option[Props]</em></td><td>if specified sends the output of the transformer to an actor created from the provided Props via ask, expecting back element of type V1 (with specified ask timeout and counting processing of single data point as failed if the type doesnt match V1). If not specified the ProcessingMessage[V] as input from transformer is not modified, thus type V = V1</td></tr><tr><td><em>aggregatorConfig: AggregatorConfig[V1, Y]</em></td><td>The AggregatorConfig provides an AggregationSupplier and distinct FilteringMapper instances, specifying which single elements (type V1) are aggregated and how theyre modified (if so) before aggregating, another one to decide this on the partial aggregations (type Y) and another one providing this as modifier / decider how / if to send a particular partial aggregation to the JobManager (e.g for an overall job aggregation. Note that such an aggregation doesnt need to be composed like this, usually more effective will be writing directly from the nodes where partial results are composed and later execute another aggregation on the partial results instead of sending all partial results to JobManager after being serialized)</td></tr><tr><td><em>expectationGenerator: Int => ExecutionExpectation</em></td><td>Given the number of single data points in the batch, provide an ExecutionExpectation that determines success/fail crtieria for the respective batch</td></tr><tr><td><em>sinkType: job.ActorRunnableSinkType.Value</em></td><td>Either &lsquo;IGNORE_SINK&rsquo; or &lsquo;REPORT_TO_ACTOR_SINK&rsquo;. If the former, results are ignored. If the latter, the ActorRef is picked from JobActorConfig by key ActorType.ACTOR_SINK. Usually this should refer to an AggregatingActor. This is the actor the results will be sent to. This happens either per element or in grouping fashion (if <code>useResultElementGrouping=true</code>)</td></tr><tr><td><em>waitTimePerElement: FiniteDuration</em></td><td>Determines the timeout, which only applies if processingActorProps is not empty and only refers to the processing time of the ASK to that specific actor</td></tr><tr><td><em>maxExecutionDuration: FiniteDuration</em></td><td>Not used in the runnable itself, but utilized in creation of RunnableExecutionActor that effectively runs the RunnableGraph that is provided by the ActorRunnable</td></tr><tr><td><em>sendResultsBack: Boolean</em></td><td>Not used in the runnable itself, but utilized in the creation of the AggregatingActor created by the RunnableExecutionActor. If set to false, no results will be provided back to the RunnableExecutionActor and via this actor to the jobSender (JobManagerActor)</td></tr></tbody></table><p>Logic in the ActorRunnable:
<img src="/images/ActorRunnableLogic.png?raw=true" alt="Alt text" title="Kolibri ActorRunnable logic"></p><p>The RunnableGraph is executed within a <code>RunnableExecutionActor</code>, which starts the execution and creates the
<code>AggregatingActor</code> to handle the single results.</p><p>The job definition is received by the SupervisorActor, which creates an JobManagerActor per job and sends the job
definition to it. Note that both SupervisorActor and JobManagerActor run on the same node, which is the node marked as *
httpserver*. The JobManagerActor takes care of batches distribution, sending new batches to process when previous ones
finish. The distribution is done via a Distributor and batches are sent via router across all nodes that have the role *
compute*
(note that each node can have multiple roles, yet there should only be one of with role httpserver).</p><p>The basic schema is as follows:</p><p><img src="/images/processing.png?raw=true" alt="Alt text" title="Kolibri processing logic"></p><p><em><strong>In Progress: More coming shortly</strong></em></p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/kolibri/kolibri-base/2-mechanisms/ title=Mechanisms><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/kolibri/kolibri-base/3-ui/ title="UI - Kolibri Watch" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1638401161></script><script src=/js/perfect-scrollbar.min.js?1638401161></script><script src=/js/perfect-scrollbar.jquery.min.js?1638401161></script><script src=/js/jquery.sticky.js?1638401161></script><script src=/js/featherlight.min.js?1638401161></script><script src=/js/highlight.pack.js?1638401161></script><script>hljs.initHighlightingOnLoad()</script><script src=/js/modernizr.custom-3.6.0.js?1638401161></script><script src=/js/learn.js?1638401161></script><script src=/js/hugo-learn.js?1638401161></script><script src=/mermaid/mermaid.js?1638401161></script><script>mermaid.initialize({startOnLoad:!0})</script></body></html>