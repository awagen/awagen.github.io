<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.110.0"><meta name=description content><link rel="shortcut icon" href=/images/kolibri.svg type=image/x-icon><title>Values :: Kolibri Documentation</title><link href=/css/nucleus.css?1691540263 rel=stylesheet><link href=/css/fontawesome-all.min.css?1691540263 rel=stylesheet><link href=/css/hybrid.css?1691540263 rel=stylesheet><link href=/css/featherlight.min.css?1691540263 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1691540263 rel=stylesheet><link href=/css/auto-complete.css?1691540263 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1691540263 rel=stylesheet><link href=/css/theme.css?1691540263 rel=stylesheet><link href=/css/tabs.css?1691540263 rel=stylesheet><link href=/css/hugo-theme.css?1691540263 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1691540263></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/kolibri_archive/kolibri-base/3-step-by-step/1-values/><nav id=sidebar><div id=header-wrapper><div id=header><img src=/images/kolibri.svg alt=Kolibri height=100><div>HOME OF KOLIBRI</div></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1691540263></script>
<script type=text/javascript src=/js/auto-complete.js?1691540263></script>
<script type=text/javascript>var baseurl="http://awagen.github.io/"</script><script type=text/javascript src=/js/search.js?1691540263></script></div><section id=homelinks><ul><li><a class=padding href=/><i class='fas fa-home'></i> Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/kolibri/ title="Kolibri Documentation" class=dd-item><a href=/kolibri/>Kolibri Documentation</a><ul><li data-nav-id=/kolibri/first-steps/ title="First Steps" class=dd-item><a href=/kolibri/first-steps/>First Steps</a><ul><li data-nav-id=/kolibri/first-steps/1-getting-started/ title="Configure / Run" class=dd-item><a href=/kolibri/first-steps/1-getting-started/><b>1. </b>Configure And Run</a></li><li data-nav-id=/kolibri/first-steps/2-using-the-ui/ title="Usage via UI" class=dd-item><a href=/kolibri/first-steps/2-using-the-ui/><b>2. </b>Usage via UI</a></li><li data-nav-id=/kolibri/first-steps/3-useful-examples/ title="Actually useful examples - Composing a job definition" class=dd-item><a href=/kolibri/first-steps/3-useful-examples/><b>3. </b>Actually useful examples - Composing a job definition</a></li><li data-nav-id=/kolibri/first-steps/4-api-endpoints/ title="API Endpoints" class=dd-item><a href=/kolibri/first-steps/4-api-endpoints/><b>4. </b>API Endpoints</a></li></ul></li></ul></li><li data-nav-id=/kolibri_archive/ title="Kolibri Documentation (Archive / Deprecated)" class="dd-item
parent"><a href=/kolibri_archive/>Kolibri Documentation (Archive / Deprecated)</a><ul><li data-nav-id=/kolibri_archive/kolibri-datatypes/ title="Kolibri-DataTypes Documentation" class=dd-item><a href=/kolibri_archive/kolibri-datatypes/>Kolibri-DataTypes Documentation</a><ul><li data-nav-id=/kolibri_archive/kolibri-datatypes/1-types/ title=Types class=dd-item><a href=/kolibri_archive/kolibri-datatypes/1-types/><b>1. </b>Types</a><ul><li data-nav-id=/kolibri_archive/kolibri-datatypes/1-types/1-categories/ title="DataType Categories" class=dd-item><a href=/kolibri_archive/kolibri-datatypes/1-types/1-categories/><b>1 - </b>DataType Categories</a></li></ul></li></ul></li><li data-nav-id=/kolibri_archive/kolibri-base/ title="Kolibri-Base Documentation" class="dd-item
parent"><a href=/kolibri_archive/kolibri-base/>Kolibri-Base Documentation</a><ul><li data-nav-id=/kolibri_archive/kolibri-base/1-basics/ title=Basics class=dd-item><a href=/kolibri_archive/kolibri-base/1-basics/><b>1. </b>Basics</a><ul><li data-nav-id=/kolibri_archive/kolibri-base/1-basics/1-runningit/ title="Getting it started" class=dd-item><a href=/kolibri_archive/kolibri-base/1-basics/1-runningit/><b>1 - </b>Getting it started</a></li><li data-nav-id=/kolibri_archive/kolibri-base/1-basics/2-monitoring/ title=Monitoring class=dd-item><a href=/kolibri_archive/kolibri-base/1-basics/2-monitoring/><b>2 - </b>Monitoring</a></li><li data-nav-id=/kolibri_archive/kolibri-base/1-basics/3-executeexamplejob/ title="Executing examples" class=dd-item><a href=/kolibri_archive/kolibri-base/1-basics/3-executeexamplejob/><b>3 - </b>Executing examples</a></li></ul></li><li data-nav-id=/kolibri_archive/kolibri-base/2-mechanisms/ title=Mechanisms class=dd-item><a href=/kolibri_archive/kolibri-base/2-mechanisms/><b>2. </b>Mechanisms</a><ul><li data-nav-id=/kolibri_archive/kolibri-base/2-mechanisms/1-overview/ title=Basics class=dd-item><a href=/kolibri_archive/kolibri-base/2-mechanisms/1-overview/><b>1 - </b>Basics</a></li></ul></li><li data-nav-id=/kolibri_archive/kolibri-base/3-step-by-step/ title="Step-by-Step Guide" class="dd-item
parent"><a href=/kolibri_archive/kolibri-base/3-step-by-step/><b>3. </b>Step-by-Step Guide</a><ul><li data-nav-id=/kolibri_archive/kolibri-base/3-step-by-step/0-overview/ title=Overview class=dd-item><a href=/kolibri_archive/kolibri-base/3-step-by-step/0-overview/><b>0 - </b>Overview</a></li><li data-nav-id=/kolibri_archive/kolibri-base/3-step-by-step/1-values/ title=Values class="dd-item active"><a href=/kolibri_archive/kolibri-base/3-step-by-step/1-values/><b>1 - </b>Values</a></li><li data-nav-id=/kolibri_archive/kolibri-base/3-step-by-step/2-generators/ title=Generators class=dd-item><a href=/kolibri_archive/kolibri-base/3-step-by-step/2-generators/><b>2 - </b>Generators</a></li><li data-nav-id=/kolibri_archive/kolibri-base/3-step-by-step/3-tags/ title=Tagging class=dd-item><a href=/kolibri_archive/kolibri-base/3-step-by-step/3-tags/><b>3 - </b>Tagging</a></li><li data-nav-id=/kolibri_archive/kolibri-base/3-step-by-step/4-processing-messages/ title="Processing Messages / Aggregation States" class=dd-item><a href=/kolibri_archive/kolibri-base/3-step-by-step/4-processing-messages/><b>4 - </b>Processing Messages / Aggregation States</a></li><li data-nav-id=/kolibri_archive/kolibri-base/3-step-by-step/5-writers/ title="Formats & Writers" class=dd-item><a href=/kolibri_archive/kolibri-base/3-step-by-step/5-writers/><b>5 - </b>Formats & Writers</a></li></ul></li><li data-nav-id=/kolibri_archive/kolibri-base/4-inputs/ title=Inputs class=dd-item><a href=/kolibri_archive/kolibri-base/4-inputs/><b>4. </b>Inputs</a></li></ul></li><li data-nav-id=/kolibri_archive/kolibri-watch/ title="Kolibri-Watch Documentation" class=dd-item><a href=/kolibri_archive/kolibri-watch/>Kolibri-Watch Documentation</a><ul><li data-nav-id=/kolibri_archive/kolibri-watch/1-ui/ title="UI - Kolibri Watch" class=dd-item><a href=/kolibri_archive/kolibri-watch/1-ui/><b>1. </b>UI - Kolibri Watch</a><ul><li data-nav-id=/kolibri_archive/kolibri-watch/1-ui/1-overview/ title=Overview class=dd-item><a href=/kolibri_archive/kolibri-watch/1-ui/1-overview/><b>1 - </b>Overview</a></li></ul></li></ul></li></ul></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://github.com/awagen/kolibri/tree/main/kolibri-datatypes><i class='fab fa-github'></i> Github kolibri-datatypes repo</a></li><li><a class=padding href=https://github.com/awagen/kolibri/tree/main/kolibri-storage><i class='fab fa-github'></i> Github kolibri-storage repo</a></li><li><a class=padding href=https://github.com/awagen/kolibri/tree/main/kolibri-definitions><i class='fab fa-github'></i> Github kolibri-definitions repo</a></li><li><a class=padding href=https://github.com/awagen/kolibri/tree/main/kolibri-fleet-zio><i class='fab fa-github'></i> Github kolibri-fleet-zio repo</a></li><li><a class=padding href=https://github.com/awagen/kolibri/tree/main/kolibri-watch><i class='fab fa-github'></i> Github kolibri-watch repo</a></li><li><a class=padding href=https://github.com/awagen/response-juggler><i class='fab fa-github'></i> Github response-juggler repo</a></li><li><a class=padding href=https://www.linkedin.com/in/andreas-wagenmann/><i class='fab fa-linkedin'></i> LinkedIn</a></li><li><a class=padding href=https://twitter.com/andiwagen><i class='fab fa-twitter'></i> Twitter</a></li></ul></section><section id=footer></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=/>Home</a> > <a href=/kolibri_archive/>Kolibri Documentation (Archive / Deprecated)</a> > <a href=/kolibri_archive/kolibri-base/>Kolibri-Base Documentation</a> > <a href=/kolibri_archive/kolibri-base/3-step-by-step/>Step-by-Step Guide</a> > Values</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#values>Values</a><ul><li><a href=#orderedvalues>OrderedValues</a></li><li><a href=#orderedmultivalues>OrderedMultiValues</a></li></ul></li><li><a href=#data-samples-and-aggregations>Data Samples and Aggregations</a><ul><li><a href=#datapoint>DataPoint</a></li><li><a href=#aggregatevalues>AggregateValues</a></li></ul></li><li><a href=#metric-representations>Metric Representations</a><ul><li><a href=#metric-aggregation>Metric Aggregation</a></li></ul></li><li><a href=#aggregators>Aggregators</a></li><li><a href=#typed-maps>Typed Maps</a></li><li><a href=#other-useful-structures>Other useful structures</a><ul><li><a href=#prioritystores>PriorityStores</a></li><li><a href=#atomicmappromisestore>AtomicMapPromiseStore</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Values</h1><h2 id=values>Values</h2><p>In the following let&rsquo;s look into which structures Kolibri provides to simplify definitions of values.</p><h3 id=orderedvalues>OrderedValues</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>OrderedValues</span><span style=color:#f92672>[</span><span style=color:#66d9ef>+T</span><span style=color:#f92672>]</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>KolibriSerializable</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>val</span> name<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>val</span> totalValueCount<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> getNthZeroBased<span style=color:#f92672>(</span>n<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Option</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> getNFromPositionZeroBased<span style=color:#f92672>(</span>position<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>,</span> n<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> getAll<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Two distinct implementations:</p><ul><li>Using explicitly passed values:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DistinctValues</span><span style=color:#f92672>[</span><span style=color:#66d9ef>+T</span><span style=color:#f92672>](</span>name<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>,</span> values<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>])</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>OrderedValues</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>]</span>
</span></span></code></pre></div></li><li>Range with defined start, end and stepSize<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RangeValues</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T:Fractional</span><span style=color:#f92672>](</span>name<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>,</span> start<span style=color:#66d9ef>:</span><span style=color:#66d9ef>T</span><span style=color:#f92672>,</span> end<span style=color:#66d9ef>:</span><span style=color:#66d9ef>T</span><span style=color:#f92672>,</span> stepSize<span style=color:#66d9ef>:</span><span style=color:#66d9ef>T</span><span style=color:#f92672>)(</span><span style=color:#66d9ef>implicit</span> v<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Numeric</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>])</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>OrderedValues</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>]</span>
</span></span></code></pre></div></li></ul><h3 id=orderedmultivalues>OrderedMultiValues</h3><p>Container for multiple OrderedValues with methods to edit (remove, add) values and methods to retrieve the
n-th element out of the permutation over all contained OrderedValues.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>OrderedMultiValues</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>KolibriSerializable</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> values<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>OrderedValues</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Any</span><span style=color:#f92672>]]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> removeValue<span style=color:#f92672>(</span>valueName<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>OrderedMultiValues</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>Boolean</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> originalValueIndexOf<span style=color:#f92672>(</span>n<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span> <span style=color:#f92672>=</span> n
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> addValue<span style=color:#f92672>(</span>values<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>OrderedValues</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Any</span><span style=color:#f92672>],</span> prepend<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Boolean</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>OrderedMultiValues</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> addValues<span style=color:#f92672>(</span>values<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>OrderedValues</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Any</span><span style=color:#f92672>]],</span> prepend<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Boolean</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>OrderedMultiValues</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> addValues<span style=color:#f92672>(</span>values<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>OrderedMultiValues</span><span style=color:#f92672>,</span> prepend<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Boolean</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>OrderedMultiValues</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> stepsForNthElementStartingFromFirstParam<span style=color:#f92672>(</span>n<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>List</span><span style=color:#f92672>[(</span><span style=color:#66d9ef>Int</span>, <span style=color:#66d9ef>Int</span><span style=color:#f92672>)]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> getParameterNameSequence<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> numberOfCombinations<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> findNthElement<span style=color:#f92672>(</span>n<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Option</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Any</span><span style=color:#f92672>]]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> findNNextElementsFromPosition<span style=color:#f92672>(</span>startElement<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>,</span> nrOfElements<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Any</span><span style=color:#f92672>]]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Implementation of OrderedMultiValues assuming a value grid, providing the methods to find n-th permutations
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param values - Seq of OrderedValues of any type
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GridOrderedMultiValues</span><span style=color:#f92672>(</span>values<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>OrderedValues</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Any</span><span style=color:#f92672>]])</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>OrderedMultiValues</span>
</span></span></code></pre></div><h4 id=batching>Batching</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Trait adding batchSize, batchNr and batchStartElement (shift of indices relative to the original OrderedMultiValues,
</span></span></span><span style=display:flex><span><span style=color:#75715e> * specifying at which element of the original the batch starts) to OrderedMultiValues  
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>OrderedMultiValuesBatch</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>OrderedMultiValues</span>  <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>val</span> batchSize<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>val</span> batchNr<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>val</span> batchStartElement<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>def</span> originalValueIndexOf<span style=color:#f92672>(</span>n<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span> <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    batchStartElement <span style=color:#f92672>+</span> n
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Batch representing at most batchSize elements of its input values. Starts at position batchSize * (batchNr -1) + 1
</span></span></span><span style=display:flex><span><span style=color:#75715e> * of the original values.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param multiValues The original values this batch represents a part of
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param batchSize   The maximum size of this batch (might contain less for last batch of values)
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param batchNr     The number of this batch. Used to determine which part of the values this batch represents. 1-based
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GridOrderedMultiValuesBatch</span><span style=color:#f92672>(</span>multiValues<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>OrderedMultiValues</span><span style=color:#f92672>,</span> batchSize<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>,</span> batchNr<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>OrderedMultiValuesBatch</span>
</span></span></code></pre></div><h4 id=implicit-conversions>Implicit Conversions</h4><p>Further conversions are defined within OrderedMultiValuesImplicits class via usage of an implicit class. On import
this will make the functions directly available on any instance of type OrderedMultiValues.</p><p>Those are (for complete list see the mentioned class):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>* from OrderedMultiValues generate iterator over sequence of named values (_._1 is name of parameter, _._2 is value)
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> toNamedParamValuesIterator<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Iterator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Seq</span><span style=color:#f92672>[(</span><span style=color:#66d9ef>String</span>, <span style=color:#66d9ef>Any</span><span style=color:#f92672>)]]</span> <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Iterator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Seq</span><span style=color:#f92672>[(</span><span style=color:#66d9ef>String</span>, <span style=color:#66d9ef>Any</span><span style=color:#f92672>)]]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * from OrderedMultiValues generate iterator over Map of key , values pairs, where key is the name of
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * the parameter in OrderedMultiValues, values is Seq over all values (e.g Seq in case any parameter name
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * is contained multiple times, as might be the case e.g for non-unique url parameters)
</span></span></span><span style=display:flex><span><span style=color:#75715e>  *
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>  */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> toParamNameValuesMapIterator<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Iterator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Map</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span>, <span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Any</span><span style=color:#f92672>]]]</span> <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Iterator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Map</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span>, <span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Any</span><span style=color:#f92672>]]]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * from OrderedMultiValues generate iterator over sequence of values (the corresponding parameter name
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * for a value would be given by the element with the same index as the respective value in the
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * multiValues.getParameterNameSequence sequence of parameter names
</span></span></span><span style=display:flex><span><span style=color:#75715e>  *
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>  */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> toParamValuesIterator<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Iterator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Any</span><span style=color:#f92672>]]</span> <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Iterator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Any</span><span style=color:#f92672>]]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * transform OrderedMultiValues instance to IndexedGenerator of value sequence (without parameter names)
</span></span></span><span style=display:flex><span><span style=color:#75715e>  *
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>  */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> toParamValuesIndexedGenerator<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>IndexedGenerator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Any</span><span style=color:#f92672>]]</span> <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>IndexedGenerator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Any</span><span style=color:#f92672>]]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * transform OrderedMultiValues instance to IndexedGenerator mappings of parameter name
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * to values for that parameter
</span></span></span><span style=display:flex><span><span style=color:#75715e>  *
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>  */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> toParamNameValuesMapIndexedGenerator<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>IndexedGenerator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Map</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span>, <span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Any</span><span style=color:#f92672>]]]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * transform OrderedMultiValues instance to IndexedGenerator Seq of (parameterName, parameterValue) pairs
</span></span></span><span style=display:flex><span><span style=color:#75715e>  *
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>  */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> toNamedParamValuesIndexedGenerator<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>IndexedGenerator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Seq</span><span style=color:#f92672>[(</span><span style=color:#66d9ef>String</span>, <span style=color:#66d9ef>Any</span><span style=color:#f92672>)]]</span>
</span></span></code></pre></div><h2 id=data-samples-and-aggregations>Data Samples and Aggregations</h2><h3 id=datapoint>DataPoint</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>DataPoint</span><span style=color:#f92672>[</span><span style=color:#66d9ef>+T</span><span style=color:#f92672>]</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>KolibriSerializable</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> weight<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Double</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> data<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>T</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DataSample</span><span style=color:#f92672>[</span><span style=color:#66d9ef>+T</span><span style=color:#f92672>](</span>weight<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Double</span><span style=color:#f92672>,</span> data<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>T</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>DataPoint</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>]</span>
</span></span></code></pre></div><h3 id=aggregatevalues>AggregateValues</h3><p>The AggregateValue trait provides a general interface for values that are generated using multiple single
values. Keeps record of the number of samples used to calculate the value, the weight
of the value, functions to add other values and a function to retrieve the weighted version of
the AggregateValue.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>AggregateValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>KolibriSerializable</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> numSamples<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> weight<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Double</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> value<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> weighted<span style=color:#f92672>(</span>weight<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Double</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>AggregateValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> add<span style=color:#f92672>(</span>other<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>AggregateValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>AggregateValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> add<span style=color:#f92672>(</span>otherValue<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>DataPoint</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>AggregateValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Implementation of AggregateValue providing methods to combine separate values.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RunningValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>weight<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Double</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                           numSamples<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                           value<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                           weightFunction<span style=color:#66d9ef>:</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>Double</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>Double</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> <span style=color:#a6e22e>Double</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                           addFunc<span style=color:#66d9ef>:</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>AggregateValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>],</span> <span style=color:#a6e22e>AggregateValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span> <span style=color:#66d9ef>=&gt;</span> A<span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>AggregateValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Running value of two distinct types, e.g can be used to record occurring errors and successful computation values
in a single record, e.g in case your computation returns Either[SomeFailType, SomeComputationValue] or similar
settings where two values are in some way connected. AggregateValue keeps the count of samples aggregated and
the current value of the aggregation</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BiRunningValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>, <span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>value1<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>AggregateValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>],</span> value2<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>AggregateValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>])</span>
</span></span></code></pre></div><h2 id=metric-representations>Metric Representations</h2><p>A MetricValue provides a simple container keeping state with BiRunningValue that keeps track of occurring error types and the
respective counts and some aggregated value type to keep track of the successful computations aggregated in the
MetricValue</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MetricValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>name<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>,</span> biValue<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>BiRunningValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Map</span><span style=color:#f92672>[</span><span style=color:#66d9ef>ComputeFailReason</span>, <span style=color:#66d9ef>Int</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>A</span><span style=color:#f92672>])</span>
</span></span></code></pre></div><p>Helper functions are provided in the MetricValue object to create frequently used values:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>def</span> createAvgFailSample<span style=color:#f92672>(</span>metricName<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>,</span> failMap<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Map</span><span style=color:#f92672>[</span><span style=color:#66d9ef>ComputeFailReason</span>, <span style=color:#66d9ef>Int</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>MetricValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Double</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> createAvgSuccessSample<span style=color:#f92672>(</span>metricName<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>,</span> value<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Double</span><span style=color:#f92672>,</span> weight<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Double</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>MetricValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Double</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> createEmptyAveragingMetricValue<span style=color:#f92672>(</span>name<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>MetricValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Double</span><span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Metrics are represented by MetricRecord instances.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>MetricRecord</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>, <span style=color:#66d9ef>B</span><span style=color:#f92672>]</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> getMetricsValue<span style=color:#f92672>(</span>key<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Option</span><span style=color:#f92672>[</span><span style=color:#66d9ef>MetricValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>]]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> addMetricDontChangeCountStore<span style=color:#f92672>(</span>metric<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>MetricValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>MetricRecord</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>, <span style=color:#66d9ef>B</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> addFullMetricsSampleAndIncreaseSampleCount<span style=color:#f92672>(</span>metrics<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>MetricValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>]*)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>MetricRecord</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>, <span style=color:#66d9ef>B</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> addRecordAndIncreaseSampleCount<span style=color:#f92672>(</span>record<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>MetricRecord</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>, <span style=color:#66d9ef>B</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>MetricRecord</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>, <span style=color:#66d9ef>B</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> metricNames<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> metricValues<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>MetricValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>]]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> containsMetric<span style=color:#f92672>(</span>key<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Boolean</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>A metric row is identified by set of parameters and metric values that hold for the parameters.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MetricRow</span><span style=color:#f92672>(</span>countStore<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ResultCountStore</span><span style=color:#f92672>,</span> params<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Map</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span>, <span style=color:#66d9ef>Seq</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span><span style=color:#f92672>]],</span> 
</span></span><span style=display:flex><span>  metrics<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Map</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span>, <span style=color:#66d9ef>MetricValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Double</span><span style=color:#f92672>]])</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>MetricRecord</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span>, <span style=color:#66d9ef>Double</span><span style=color:#f92672>]</span> 
</span></span></code></pre></div><p>The MetricRow companion object provides multiple helper methods for easier composition.</p><p>MetricDocument represents a map of parameter set to MetricRow.
Implementation uses a mutable map. A single document will only be modified within a single actor,
thus single thread at a time.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MetricDocument</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span> <span style=color:#66d9ef>&lt;:</span> <span style=color:#66d9ef>AnyRef</span><span style=color:#f92672>](</span>id<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>,</span> rows<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>mutable.Map</span><span style=color:#f92672>[</span><span style=color:#66d9ef>ParamMap</span>, <span style=color:#66d9ef>MetricRow</span><span style=color:#f92672>])</span>
</span></span></code></pre></div><p>Usually Tag type would be used as type A, to group the results based on some grouping criteria.
It comes with methods such as to add other results or generate a weighted copy.</p><h3 id=metric-aggregation>Metric Aggregation</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * MetricAggregation that keeps track of full MetricDocuments for keys of defined type.
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * Each key stands for a separate aggregation, which can be used for selectively aggregating subsets of results
</span></span></span><span style=display:flex><span><span style=color:#75715e>  *
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * @param aggregationStateMap - map with key = key of defined type A, value = MetricDocument, which maps a ParamMap to
</span></span></span><span style=display:flex><span><span style=color:#75715e>  *                            a MetricRow, which carries all relevant parameters and corresponding metrics
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * @param keyMapFunction      - optional function to map result keys to before adding to aggregation. E.g can be used 
</span></span></span><span style=display:flex><span><span style=color:#75715e>  *                                in case all incoming results shall only be aggregated under a single &#34;ALL&#34; 
</span></span></span><span style=display:flex><span><span style=color:#75715e>  *                                aggregation instead of keeping track of distinct results per key
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * @tparam A - type of the keys that describe the aggregation groups
</span></span></span><span style=display:flex><span><span style=color:#75715e>  */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MetricAggregation</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span> <span style=color:#66d9ef>&lt;:</span> <span style=color:#66d9ef>AnyRef</span><span style=color:#f92672>](</span>aggregationStateMap<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>mutable.Map</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>, <span style=color:#66d9ef>MetricDocument</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]]</span> <span style=color:#66d9ef>=</span> 
</span></span><span style=display:flex><span>  mutable<span style=color:#f92672>.</span><span style=color:#a6e22e>Map</span><span style=color:#f92672>.</span>empty<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>, <span style=color:#66d9ef>MetricDocument</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]],</span> keyMapFunction<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>SerializableFunction1</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>, <span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> identity<span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>WithCount</span>
</span></span></code></pre></div><h2 id=aggregators>Aggregators</h2><p>The aggregation of partial results is provided by an instance of type Aggregator</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Aggregator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>-U:</span> <span style=color:#66d9ef>TypeTag</span>, <span style=color:#66d9ef>V:</span> <span style=color:#66d9ef>TypeTag</span><span style=color:#f92672>]</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>KolibriSerializable</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> add<span style=color:#f92672>(</span>sample<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>U</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Unit</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> aggregation<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>V</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> addAggregate<span style=color:#f92672>(</span>aggregatedValue<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>V</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Unit</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>See Aggregators class for Aggregators object containing distinct aggregator types.
Some examples are given below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Aggregator taking start value generator, aggregation and merge functions to define the aggregation behavior
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param aggFunc - Given sample of type U and aggregation of type V, generate new value of type V
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param startValueGen - supplier of start value of aggregation, type V
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param mergeFunc - merge function of aggregations, taking two values of type V and providing new value of type V
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @tparam U - type of single data points
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @tparam V - type of aggregation
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BaseAggregator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>U:</span> <span style=color:#66d9ef>TypeTag</span>, <span style=color:#66d9ef>V:</span> <span style=color:#66d9ef>TypeTag</span><span style=color:#f92672>](</span>aggFunc<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>SerializableFunction2</span><span style=color:#f92672>[</span><span style=color:#66d9ef>U</span>, <span style=color:#66d9ef>V</span>, <span style=color:#66d9ef>V</span><span style=color:#f92672>],</span> 
</span></span><span style=display:flex><span>                                               startValueGen<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>SerializableSupplier</span><span style=color:#f92672>[</span><span style=color:#66d9ef>V</span><span style=color:#f92672>],</span> 
</span></span><span style=display:flex><span>                                               mergeFunc<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>SerializableFunction2</span><span style=color:#f92672>[</span><span style=color:#66d9ef>V</span>, <span style=color:#66d9ef>V</span>, <span style=color:#66d9ef>V</span><span style=color:#f92672>])</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Aggregator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>U</span>, <span style=color:#66d9ef>V</span><span style=color:#f92672>]</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param aggFunc - aggregation function, taking single data point of type TT, aggregated value of type V, 
</span></span></span><span style=display:flex><span><span style=color:#75715e>      providing new aggregation of type V
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param startValueForKey - function giving an initial aggregation value, given a Tag
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param mergeFunc - merge function of aggregation values
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param keyMapFunction - function mapping value of type Tag to value of type Tag (in case the Tag shall not be 
</span></span></span><span style=display:flex><span><span style=color:#75715e>      mapped, just use identity)
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @tparam TT - type of single data point, needs to extend TaggedWithType
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @tparam V - type of aggregation
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BasePerClassAggregator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>TT</span> <span style=color:#66d9ef>&lt;:</span> <span style=color:#66d9ef>TaggedWithType</span> <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>TypeTag</span>, <span style=color:#66d9ef>V:</span> <span style=color:#66d9ef>TypeTag</span><span style=color:#f92672>](</span>aggFunc<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>SerializableFunction2</span><span style=color:#f92672>[</span><span style=color:#66d9ef>TT</span>, <span style=color:#66d9ef>V</span>, <span style=color:#66d9ef>V</span><span style=color:#f92672>],</span>
</span></span><span style=display:flex><span>                                                                           startValueForKey<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>SerializableFunction1</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Tag</span>, <span style=color:#66d9ef>V</span><span style=color:#f92672>],</span>
</span></span><span style=display:flex><span>                                                                           mergeFunc<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>SerializableFunction2</span><span style=color:#f92672>[</span><span style=color:#66d9ef>V</span>, <span style=color:#66d9ef>V</span>, <span style=color:#66d9ef>V</span><span style=color:#f92672>],</span>
</span></span><span style=display:flex><span>                                                                           keyMapFunction<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>SerializableFunction1</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Tag</span>, <span style=color:#66d9ef>Tag</span><span style=color:#f92672>])</span> 
</span></span><span style=display:flex><span>                                                                           <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Aggregator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>TT</span>, <span style=color:#66d9ef>Map</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Tag</span>, <span style=color:#66d9ef>V</span><span style=color:#f92672>]]</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Aggregator that aggregates (running) averages per class
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param keyMapFunction - function mapping value of type Tag to value of type Tag (in case the Tag shall not be 
</span></span></span><span style=display:flex><span><span style=color:#75715e>      mapped, just use identity)
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TagKeyRunningDoubleAvgPerClassAggregator</span><span style=color:#f92672>(</span>keyMapFunction<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>SerializableFunction1</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Tag</span>, <span style=color:#66d9ef>Tag</span><span style=color:#f92672>])</span> <span style=color:#66d9ef>extends</span> 
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>BasePerClassAggregator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>TaggedWithType</span> <span style=color:#66d9ef>with</span> <span style=color:#66d9ef>DataPoint</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Double</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>AggregateValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Double</span><span style=color:#f92672>]](</span>
</span></span><span style=display:flex><span>      aggFunc <span style=color:#66d9ef>=</span> <span style=color:#f92672>(</span>x<span style=color:#f92672>,</span> y<span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> y<span style=color:#f92672>.</span>add<span style=color:#f92672>(</span>x<span style=color:#f92672>),</span>
</span></span><span style=display:flex><span>      startValueForKey <span style=color:#66d9ef>=</span> <span style=color:#66d9ef>_</span> <span style=color:#66d9ef>=&gt;</span> doubleAvgRunningValue<span style=color:#f92672>(</span>weightedCount <span style=color:#66d9ef>=</span> <span style=color:#ae81ff>0.0</span><span style=color:#f92672>,</span> count <span style=color:#66d9ef>=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>,</span> value <span style=color:#66d9ef>=</span> <span style=color:#ae81ff>0.0</span><span style=color:#f92672>),</span>
</span></span><span style=display:flex><span>      mergeFunc <span style=color:#66d9ef>=</span> <span style=color:#f92672>(</span>x<span style=color:#f92672>,</span> y<span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> x<span style=color:#f92672>.</span>add<span style=color:#f92672>(</span>y<span style=color:#f92672>),</span>
</span></span><span style=display:flex><span>      keyMapFunction<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Aggregator aggregating to (running) averages overall
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TagKeyRunningDoubleAvgAggregator</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>BaseAggregator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>DataPoint</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Double</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>AggregateValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Double</span><span style=color:#f92672>]](</span>
</span></span><span style=display:flex><span>    aggFunc <span style=color:#66d9ef>=</span> <span style=color:#f92672>(</span>x<span style=color:#f92672>,</span> y<span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> y<span style=color:#f92672>.</span>add<span style=color:#f92672>(</span>x<span style=color:#f92672>),</span>
</span></span><span style=display:flex><span>    startValueGen <span style=color:#66d9ef>=</span> <span style=color:#f92672>()</span> <span style=color:#66d9ef>=&gt;</span> doubleAvgRunningValue<span style=color:#f92672>(</span>weightedCount <span style=color:#66d9ef>=</span> <span style=color:#ae81ff>0.0</span><span style=color:#f92672>,</span> count <span style=color:#66d9ef>=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>,</span> value <span style=color:#66d9ef>=</span> <span style=color:#ae81ff>0.0</span><span style=color:#f92672>),</span>
</span></span><span style=display:flex><span>    mergeFunc <span style=color:#66d9ef>=</span> <span style=color:#f92672>(</span>x<span style=color:#f92672>,</span> y<span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> x<span style=color:#f92672>.</span>add<span style=color:#f92672>(</span>y<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>    * In case of a mapping function that alters original tags, ignoreIdDiff would need to be true to avoid conflicts.
</span></span></span><span style=display:flex><span><span style=color:#75715e>    * Setting this attribute to true enables aggregating data for the original tag to data for the mapped tag.
</span></span></span><span style=display:flex><span><span style=color:#75715e>    *
</span></span></span><span style=display:flex><span><span style=color:#75715e>    * @param keyMapFunction - mapping function of Tag of input sample data
</span></span></span><span style=display:flex><span><span style=color:#75715e>    * @param ignoreIdDiff - determines whether merging aggregations for different IDs is allowed
</span></span></span><span style=display:flex><span><span style=color:#75715e>    */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TagKeyMetricDocumentPerClassAggregator</span><span style=color:#f92672>(</span>keyMapFunction<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>SerializableFunction1</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Tag</span>, <span style=color:#66d9ef>Tag</span><span style=color:#f92672>],</span> 
</span></span><span style=display:flex><span>    ignoreIdDiff<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Boolean</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> 
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>BasePerClassAggregator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>TaggedWithType</span> <span style=color:#66d9ef>with</span> <span style=color:#66d9ef>DataPoint</span><span style=color:#f92672>[</span><span style=color:#66d9ef>MetricRow</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>MetricDocument</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Tag</span><span style=color:#f92672>]](</span>
</span></span><span style=display:flex><span>        aggFunc <span style=color:#66d9ef>=</span> <span style=color:#f92672>(</span>x<span style=color:#f92672>,</span> y<span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          y<span style=color:#f92672>.</span>add<span style=color:#f92672>(</span>x<span style=color:#f92672>.</span>data<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          y
</span></span><span style=display:flex><span>        <span style=color:#f92672>},</span>
</span></span><span style=display:flex><span>        startValueForKey <span style=color:#66d9ef>=</span> x <span style=color:#66d9ef>=&gt;</span> <span style=color:#a6e22e>MetricDocument</span><span style=color:#f92672>.</span>empty<span style=color:#f92672>[</span><span style=color:#66d9ef>Tag</span><span style=color:#f92672>](</span>x<span style=color:#f92672>),</span>
</span></span><span style=display:flex><span>        mergeFunc <span style=color:#66d9ef>=</span> <span style=color:#f92672>(</span>x<span style=color:#f92672>,</span> y<span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          x<span style=color:#f92672>.</span>add<span style=color:#f92672>(</span>y<span style=color:#f92672>,</span> ignoreIdDiff <span style=color:#66d9ef>=</span> ignoreIdDiff<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          x
</span></span><span style=display:flex><span>        <span style=color:#f92672>},</span>
</span></span><span style=display:flex><span>        keyMapFunction<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>    * In case of a mapping function that alters original tags, ignoreIdDiff would need to be true to avoid conflicts.
</span></span></span><span style=display:flex><span><span style=color:#75715e>    * Setting this attribute to true enables aggregating data for the original tag to data for the mapped tag.
</span></span></span><span style=display:flex><span><span style=color:#75715e>    *
</span></span></span><span style=display:flex><span><span style=color:#75715e>    * @param keyMapFunction - mapping function of Tag of input sample data
</span></span></span><span style=display:flex><span><span style=color:#75715e>    * @param ignoreIdDiff - determines whether merging aggregations for different IDs is allowed
</span></span></span><span style=display:flex><span><span style=color:#75715e>    */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TagKeyMetricAggregationPerClassAggregator</span><span style=color:#f92672>(</span>keyMapFunction<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>SerializableFunction1</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Tag</span>, <span style=color:#66d9ef>Tag</span><span style=color:#f92672>],</span> 
</span></span><span style=display:flex><span>  ignoreIdDiff<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Boolean</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Aggregator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>TaggedWithType</span> <span style=color:#66d9ef>with</span> <span style=color:#66d9ef>DataPoint</span><span style=color:#f92672>[</span><span style=color:#66d9ef>MetricRow</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>MetricAggregation</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Tag</span><span style=color:#f92672>]]</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>    * Wrapper for typed aggregators to accept any message and aggregate only those matching the type
</span></span></span><span style=display:flex><span><span style=color:#75715e>    *
</span></span></span><span style=display:flex><span><span style=color:#75715e>    * @param aggregator
</span></span></span><span style=display:flex><span><span style=color:#75715e>    * @tparam T
</span></span></span><span style=display:flex><span><span style=color:#75715e>    * @tparam V
</span></span></span><span style=display:flex><span><span style=color:#75715e>    */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BaseAnyAggregator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T:</span> <span style=color:#66d9ef>TypeTag</span>, <span style=color:#66d9ef>V:</span> <span style=color:#66d9ef>TypeTag</span><span style=color:#f92672>](</span>aggregator<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Aggregator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span>, <span style=color:#66d9ef>V</span><span style=color:#f92672>])</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Aggregator</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Any</span>, <span style=color:#66d9ef>V</span><span style=color:#f92672>]</span>
</span></span></code></pre></div><h2 id=typed-maps>Typed Maps</h2><p>Typed maps make assumptions on the type of the values, and thus allow usage of map structure for distinct types
of values with type guarantee. The assumptions are either baked into the key values or to be specified in the
get call to retrieve the values.</p><p>Distinct implementations are provided, which mainly vary on the dimensions mutable/immutable and strong/weak typing.
The strongly typed maps make use of TypeTag, causing use of reflection, and thus might slow down executions if
evoked frequently.
Weakly typed maps will return empty result (None) on get if the value cannot be cast to the expected type.</p><p>Strong typing (available as mutable or immutable implementation, refer to implementation for details):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>TypeTaggedMap</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>KolibriSerializable</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> isOfType<span style=color:#f92672>[</span><span style=color:#66d9ef>T:</span> <span style=color:#66d9ef>TypeTag</span><span style=color:#f92672>](</span>data<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>T</span><span style=color:#f92672>,</span> typeInstance<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Type</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Boolean</span> <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    typeOf<span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>]</span> <span style=color:#f92672>=:=</span> typeInstance
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> put<span style=color:#f92672>[</span><span style=color:#66d9ef>T:</span> <span style=color:#66d9ef>TypeTag</span>, <span style=color:#66d9ef>V</span><span style=color:#f92672>](</span>key<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ClassTyped</span><span style=color:#f92672>[</span><span style=color:#66d9ef>V</span><span style=color:#f92672>],</span> value<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>T</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>Option</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>],</span> <span style=color:#a6e22e>TypeTaggedMap</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> remove<span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>](</span>key<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ClassTyped</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>Option</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>],</span> <span style=color:#a6e22e>TypeTaggedMap</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> get<span style=color:#f92672>[</span><span style=color:#66d9ef>V</span><span style=color:#f92672>](</span>key<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ClassTyped</span><span style=color:#f92672>[</span><span style=color:#66d9ef>V</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Option</span><span style=color:#f92672>[</span><span style=color:#66d9ef>V</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> keys<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Iterable</span><span style=color:#f92672>[</span><span style=color:#66d9ef>ClassTyped</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Any</span><span style=color:#f92672>]]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> keySet<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>collection.Set</span><span style=color:#f92672>[</span><span style=color:#66d9ef>ClassTyped</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Any</span><span style=color:#f92672>]]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Weakly typed (refer to implementation for details):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>WeaklyTypedMap</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>]</span> <span style=color:#a6e22e>extends</span> <span style=color:#a6e22e>KolibriSerializable</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> put<span style=color:#f92672>[</span><span style=color:#66d9ef>U</span><span style=color:#f92672>](</span>key<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>T</span><span style=color:#f92672>,</span> value<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>U</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Unit</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> remove<span style=color:#f92672>(</span>key<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Option</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Any</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> get<span style=color:#f92672>[</span><span style=color:#66d9ef>U</span><span style=color:#f92672>](</span>key<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>T</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Option</span><span style=color:#f92672>[</span><span style=color:#66d9ef>U</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> keys<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Iterable</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> keySet<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>collection.Set</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=other-useful-structures>Other useful structures</h2><h3 id=prioritystores>PriorityStores</h3><p>Given some ordering keeps n top elements, utilizing priority queue. Elements can be added continuously and queue state
will be updated.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * Priority store backed by PriorityQueue. Allows adding of elements and by some ordering criterium
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * only keep n elements that are the first according to the ordering
</span></span></span><span style=display:flex><span><span style=color:#75715e>  */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PriorityStore</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span>, <span style=color:#66d9ef>U</span><span style=color:#f92672>]</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> keep_n<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> ordering<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Ordering</span><span style=color:#f92672>[</span><span style=color:#66d9ef>U</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> elementToKey<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>U</span> <span style=color:#f92672>=&gt;</span> T
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> queueReversed<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>mutable.PriorityQueue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>U</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> addEntry<span style=color:#f92672>(</span>entry<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>U</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Unit</span> 
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BasePriorityStore</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span>, <span style=color:#66d9ef>U</span><span style=color:#f92672>](</span>keep_n<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                                   ordering<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Ordering</span><span style=color:#f92672>[</span><span style=color:#66d9ef>U</span><span style=color:#f92672>],</span>
</span></span><span style=display:flex><span>                                   elementToKey<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>U</span> <span style=color:#f92672>=&gt;</span> T<span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>PriorityStore</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span>, <span style=color:#66d9ef>U</span><span style=color:#f92672>]</span>
</span></span></code></pre></div><h3 id=atomicmappromisestore>AtomicMapPromiseStore</h3><p>Thread-safe store that uses first request for resource to load the data.
This can involve more time-consuming loads, as each retrieve call is answered by a Promise,
that gets fulfilled as soon as resource loading is finished.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * Implementation ensuring thread safety of the value storage and also ensuring
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * that no more than one request leads to the creation of the stored resource which
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * could potentially be expensive (e.g in case multiple experiment batch processing
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * actors on a single node try to request the ressource at once)
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * E.g used to load some data expensive to load within an object to have only one data-instance per node
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * @tparam U - the key used to identify a value
</span></span></span><span style=display:flex><span><span style=color:#75715e>  * @tparam V - the corresponding value
</span></span></span><span style=display:flex><span><span style=color:#75715e>  */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>AtomicMapPromiseStore</span><span style=color:#f92672>[</span><span style=color:#66d9ef>U</span>,<span style=color:#66d9ef>V</span><span style=color:#f92672>]</span>
</span></span></code></pre></div><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/kolibri_archive/kolibri-base/3-step-by-step/0-overview/ title=Overview><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/kolibri_archive/kolibri-base/3-step-by-step/2-generators/ title=Generators style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1691540263></script>
<script src=/js/perfect-scrollbar.min.js?1691540263></script>
<script src=/js/perfect-scrollbar.jquery.min.js?1691540263></script>
<script src=/js/jquery.sticky.js?1691540263></script>
<script src=/js/featherlight.min.js?1691540263></script>
<script src=/js/highlight.pack.js?1691540263></script>
<script>hljs.initHighlightingOnLoad()</script><script src=/js/modernizr.custom-3.6.0.js?1691540263></script>
<script src=/js/learn.js?1691540263></script>
<script src=/js/hugo-learn.js?1691540263></script>
<script src=/mermaid/mermaid.js?1691540263></script>
<script>mermaid.initialize({startOnLoad:!0})</script></body></html>